<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø©</title>
  <style>
    body{font-family:'Cairo',sans-serif;background:linear-gradient(135deg,#eef2f3,#8e9eab);margin:0;padding:0;color:#333}
    .wrap{max-width:1000px;margin:30px auto;background:white;border-radius:12px;box-shadow:0 8px 25px rgba(0,0,0,.15);padding:25px}
    h2{text-align:center;color:#0b63d6;margin-bottom:20px}
    button{background:#0b63d6;color:#fff;border:none;border-radius:8px;padding:8px 16px;cursor:pointer;transition:0.3s}
    button:hover{background:#084b9e}
    input,select{width:100%;padding:8px;margin-bottom:10px;border:1px solid #ccc;border-radius:8px}
    .list{margin-top:15px}
    .item{background:#f8f9fb;border:1px solid #ddd;border-radius:10px;padding:10px;margin-bottom:8px;box-shadow:0 2px 6px rgba(0,0,0,.05)}
    .hidden{display:none}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .col{flex:1;min-width:300px}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>ğŸ“‹ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>

    <div id="login-view">
      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
      <input id="login-username" placeholder="Username">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input id="login-password" type="password">
      <button id="btn-login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="main-view" class="hidden">
      <div class="header"><div>Ù…Ø±Ø­Ø¨Ù‹Ø§ <b id="user-name"></b> | Ø§Ù„Ø¯ÙˆØ±: <b id="user-role"></b></div><button id="btn-logout">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button></div>

      <!-- Admin Panel -->
      <div id="admin-panel" class="hidden">
        <h3>ğŸ‘‘ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</h3>
        <div class="row">
          <div class="col">
            <h4>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</h4>
            <input id="new-username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <input id="new-password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <select id="new-role"><option value="sales">Sales</option><option value="admission">Admission</option></select>
            <button id="btn-add-user">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</button>
          </div>
          <div class="col">
            <h4>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h4>
            <div id="user-list" class="list"></div>
            <h4>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h4>
            <button id="btn-clear-data" style="background:#c0392b">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
          </div>
        </div>
      </div>

      <!-- Sales Panel -->
      <div id="sales-panel" class="hidden">
        <h3>ğŸ’¼ Ù„ÙˆØ­Ø© Ø§Ù„Ø³ÙŠÙ„Ø²</h3>
        <input id="sales-question" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„">
        <button id="btn-add-question">Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button>
        <label>Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯</label>
        <input id="sales-slot" type="datetime-local">
        <button id="btn-add-slot">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯</button>
        <h4>ğŸ“… ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h4>
        <div id="sales-slots" class="list"></div>
        <h4>âœ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø¬Ø§Ø¨Ø©</h4>
        <div id="sales-answers" class="list"></div>
      </div>

      <!-- Admission Panel -->
      <div id="admission-panel" class="hidden">
        <h3>ğŸ§¾ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ø´Ù†</h3>
        <h4>ğŸ•“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h4>
        <div id="pending-questions" class="list"></div>
        <h4>ğŸ“† Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h4>
        <div id="pending-slots" class="list"></div>
        <h4>âœ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø¬Ø§Ø¨Ø©</h4>
        <div id="answered-questions" class="list"></div>
      </div>
    </div>
  </div>

  <script>
    const LS={users:'users',questions:'questions',slots:'slots',answers:'answers'};
    const get=k=>JSON.parse(localStorage.getItem(k)||'[]');
    const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));

    // init admin user
    const users=get(LS.users);
    if(!users.find(u=>u.username==='Nasr')){
      users.push({username:'Nasr',password:'Asdof123',role:'admin'});
      save(LS.users,users);
    }

    let currentUser=null;

    const loginView=document.getElementById('login-view');
    const mainView=document.getElementById('main-view');
    const adminPanel=document.getElementById('admin-panel');
    const salesPanel=document.getElementById('sales-panel');
    const admissionPanel=document.getElementById('admission-panel');

    document.getElementById('btn-login').onclick=()=>{
      const u=document.getElementById('login-username').value.trim();
      const p=document.getElementById('login-password').value.trim();
      const found=get(LS.users).find(x=>x.username===u&&x.password===p);
      if(!found)return alert('Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
      currentUser=found;
      document.getElementById('user-name').textContent=u;
      document.getElementById('user-role').textContent=found.role;
      loginView.classList.add('hidden');mainView.classList.remove('hidden');showRole(found.role);
    };

    document.getElementById('btn-logout').onclick=()=>{location.reload();};

    function showRole(role){
      adminPanel.classList.add('hidden');salesPanel.classList.add('hidden');admissionPanel.classList.add('hidden');
      if(role==='admin')adminPanel.classList.remove('hidden');
      if(role==='sales')salesPanel.classList.remove('hidden');
      if(role==='admission')admissionPanel.classList.remove('hidden');
      refreshAll();
    }

    // Admin controls
    document.getElementById('btn-add-user').onclick=()=>{
      const u=document.getElementById('new-username').value.trim();
      const p=document.getElementById('new-password').value.trim();
      const r=document.getElementById('new-role').value;
      if(!u||!p)return alert('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      const all=get(LS.users);
      if(all.find(x=>x.username===u))return alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
      all.push({username:u,password:p,role:r});
      save(LS.users,all);
      refreshAll();alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©');
    };

    document.getElementById('btn-clear-data').onclick=()=>{
      if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ'))return;
      localStorage.clear();alert('ØªÙ… Ø§Ù„Ù…Ø³Ø­');location.reload();
    };

    window.deleteUser=u=>{
      if(u==='Nasr')return alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ');
      let all=get(LS.users).filter(x=>x.username!==u);save(LS.users,all);refreshAll();
    };

    // Sales actions
    document.getElementById('btn-add-question').onclick=()=>{
      const text=document.getElementById('sales-question').value.trim();
      if(!text)return alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„');
      const q=get(LS.questions);
      q.push({id:'q'+Date.now(),text,from:currentUser.username,date:new Date().toISOString(),answered:false});
      save(LS.questions,q);
      alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„');refreshAll();
    };

    document.getElementById('btn-add-slot').onclick=()=>{
      const time=document.getElementById('sales-slot').value;
      if(!time)return alert('Ø­Ø¯Ø¯ ÙˆÙ‚ØªÙ‹Ø§');
      const s=get(LS.slots);
      s.push({id:'s'+Date.now(),time,from:currentUser.username,confirmed:false,confirmedBy:null});
      save(LS.slots,s);
      alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¹Ø¯');refreshAll();
    };

    // Admission actions
    window.answerQuestion=id=>{
      const val=document.getElementById('ans-'+id).value.trim();if(!val)return alert('Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø¯');
      const qArr=get(LS.questions);const q=qArr.find(x=>x.id===id);q.answered=true;q.answeredAt=new Date().toISOString();save(LS.questions,qArr);
      const answers=get(LS.answers);const diff=(new Date(q.answeredAt)-new Date(q.date))/60000;
      answers.push({id,question:q.text,from:q.from,answeredBy:currentUser.username,answer:val,dateQ:q.date,dateA:q.answeredAt,diff});save(LS.answers,answers);
      alert('ØªÙ… Ø§Ù„Ø±Ø¯');refreshAll();
    };

    window.confirmSlot=id=>{
      const slots=get(LS.slots);const s=slots.find(x=>x.id===id);s.confirmed=true;s.confirmedBy=currentUser.username;save(LS.slots,slots);
      const ms=new Date(s.time).getTime()-Date.now()-1800000;
      if(ms>0)setTimeout(()=>{const audio=new Audio('https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg');audio.loop=true;audio.play();if(confirm('ØªÙ†Ø¨ÙŠÙ‡! Ù…ÙˆØ¹Ø¯Ùƒ Ø¹Ù†Ø¯ '+new Date(s.time).toLocaleString())){audio.pause();}},ms);
      refreshAll();
    };

    function renderAdmin(){
      const users=get(LS.users);
      document.getElementById('user-list').innerHTML=users.map(u=>`<div class='item'>${u.username} - ${u.role} ${u.username!=='Nasr'?`<button onclick='deleteUser("${u.username}")' style='background:#e74c3c'>Ø­Ø°Ù</button>`:''}</div>`).join('');
    }

    function renderAdmission(){
      const qs=get(LS.questions);
      const pend=qs.filter(q=>!q.answered);
      document.getElementById('pending-questions').innerHTML=pend.map(q=>`<div class='item'><b>${q.text}</b><br>Ø³Ø£Ù„: ${q.from}<br><input id='ans-${q.id}' placeholder='Ø§Ù„Ø±Ø¯'><button onclick='answerQuestion("${q.id}")'>Ø±Ø¯</button></div>`).join('')||'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
      const slots=get(LS.slots);
      const upcoming=slots.sort((a,b)=>new Date(a.time)-new Date(b.time));
      document.getElementById('pending-slots').innerHTML=upcoming.map(s=>`<div class='item'><b>${new Date(s.time).toLocaleString()}</b><br>Ø£Ø¶Ø§ÙÙ‡: ${s.from}<br>${s.confirmed?`<span style='color:green'>âœ” Ù…Ø¤ÙƒØ¯ Ø¨ÙˆØ§Ø³Ø·Ø© ${s.confirmedBy}</span>`:`<button onclick='confirmSlot("${s.id}")'>ØªØ£ÙƒÙŠØ¯</button>`}</div>`).join('')||'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
      renderAnswered();
    }

    function renderAnswered(){
      const a=get(LS.answers);
      const html=a.map(x=>`<div class='item'><b>${x.question}</b><br>Ø³Ø£Ù„: ${x.from}<br>Ø£Ø¬Ø§Ø¨: ${x.answeredBy}<br>Ø³ÙØ¦Ù„: ${new Date(x.dateQ).toLocaleString()}<br>Ø£ÙØ¬ÙŠØ¨: ${new Date(x.dateA).toLocaleString()}<br>Ø§Ù„Ù…Ø¯Ø©: ${x.diff.toFixed(1)} Ø¯Ù‚ÙŠÙ‚Ø©<br>Ø§Ù„Ø±Ø¯: ${x.answer}</div>`).join('')||'Ù„Ø§ ØªÙˆØ¬Ø¯';
      document.getElementById('answered-questions').innerHTML=html;
      document.getElementById('sales-answers').innerHTML=html;
    }

    function renderSales(){
      const s=get(LS.slots).sort((a,b)=>new Date(a.time)-new Date(b.time));
      document.getElementById('sales-slots').innerHTML=s.map(x=>`<div class='item'><b>${new Date(x.time).toLocaleString()}</b><br>Ø£Ø¶Ø§ÙÙ‡: ${x.from}<br>${x.confirmed?`âœ” Ù…Ø¤ÙƒØ¯ Ø¨ÙˆØ§Ø³Ø·Ø© ${x.confirmedBy}`:'âŒ ØºÙŠØ± Ù…Ø¤ÙƒØ¯'}</div>`).join('')||'Ù„Ø§ ØªÙˆØ¬Ø¯';
      renderAnswered();
    }

    function refreshAll(){
      if(currentUser.role==='admin')renderAdmin();
      if(currentUser.role==='admission')renderAdmission();
      if(currentUser.role==='sales')renderSales();
    }
  </script>
</body>
</html>